{%- comment -%}
Edge Navigation (Two-ring model)
- Left/Right: prev/next within the same collection
- Up/Down:    first item of previous/next collection (no wrap)
- Auto arrow color via mix-blend-mode:difference
- Minimal, watermark style; hover to reveal on desktop
- Touch: swipe left/right to navigate; arrows visually hidden on small screens

Expect these front-matter keys on every page (generated by convert_content.py):
nav:
  prev_in_collection: /collection/slug/
  next_in_collection: /collection/slug/
  prev_collection:    /collection/first-item/
  next_collection:    /collection/first-item/
{%- endcomment -%}

{%- assign nav_prev_in   = page.nav.prev_in_collection    | default: nil -%}
{%- assign nav_next_in   = page.nav.next_in_collection    | default: nil -%}
{%- assign nav_prev_coll = page.nav.prev_collection       | default: nil -%}
{%- assign nav_next_coll = page.nav.next_collection       | default: nil -%}

<style>
  /* Container that holds all four edge targets */
  .edge-nav {
    position: fixed;
    inset: 0;               /* full viewport */
    pointer-events: none;   /* let clicks pass unless on targets */
    z-index: 9999;
  }

  /* Shared style for arrow targets */
  .edge-nav__target {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;      /* enable clicks on the target */
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    outline: none;
  }

  /* Watermark arrow glyphs (CSS triangles) */
  .edge-nav__icon {
    width: 36px;
    height: 36px;
    opacity: 0.10;              /* watermark baseline */
    transition: opacity 160ms ease;
    filter: saturate(0);        /* neutralize accidental color inheritance */
    mix-blend-mode: difference; /* AUTO color on any bg (light/dark/gradient) */
  }
  .edge-nav__target:hover .edge-nav__icon,
  .edge-nav__target:focus .edge-nav__icon {
    opacity: 0.35;              /* reveal on hover/focus */
  }

  /* Left / Right edge hot-zones */
  .edge-nav__left,
  .edge-nav__right {
    top: 0;
    bottom: 0;
    width: min(18vw, 160px);
  }
  .edge-nav__left  { left: 0;  justify-content: flex-start; padding-left: 10px; }
  .edge-nav__right { right: 0; justify-content: flex-end;   padding-right: 10px; }

  /* Up / Down edge hot-zones */
  .edge-nav__top,
  .edge-nav__bottom {
    left: 0;
    right: 0;
    height: min(18vh, 140px);
  }
  .edge-nav__top    { top: 0;    align-items: flex-start; justify-content: center; padding-top: 10px; }
  .edge-nav__bottom { bottom: 0; align-items: flex-end;   justify-content: center; padding-bottom: 10px; }

  /* Arrow glyphs built with borders (no external assets) */
  .arrow--left,
  .arrow--right,
  .arrow--up,
  .arrow--down {
    position: relative;
  }
  /* Right: ▸ */
  .arrow--right::before {
    content: "";
    display: block;
    width: 0; height: 0;
    border-top: 12px solid transparent;
    border-bottom: 12px solid transparent;
    border-left: 18px solid currentColor;
  }
  /* Left: ◂ */
  .arrow--left::before {
    content: "";
    display: block;
    width: 0; height: 0;
    border-top: 12px solid transparent;
    border-bottom: 12px solid transparent;
    border-right: 18px solid currentColor;
  }
  /* Up: ▴ */
  .arrow--up::before {
    content: "";
    display: block;
    width: 0; height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-bottom: 18px solid currentColor;
  }
  /* Down: ▾ */
  .arrow--down::before {
    content: "";
    display: block;
    width: 0; height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 18px solid currentColor;
  }

  /* We rely on mix-blend-mode to auto-invert; set neutral color */
  .edge-nav { color: #fff; }

  /* Hide targets that have no link */
  .edge-nav__target[aria-disabled="true"] {
    pointer-events: none;
    opacity: 0;  /* fully hidden if no destination */
  }

  /* Mobile: keep arrows super subtle and non-blocking; swipe is primary */
  @media (max-width: 768px) {
    .edge-nav__icon { opacity: 0.04; }
    .edge-nav__target:hover .edge-nav__icon,
    .edge-nav__target:focus .edge-nav__icon { opacity: 0.12; }
  }
</style>

<div class="edge-nav" role="navigation" aria-label="Edge navigation">

  <!-- LEFT: previous within collection -->
  <a
    class="edge-nav__target edge-nav__left"
    href="{{ nav_prev_in | default:'#' }}"
    aria-label="Previous in collection"
    aria-disabled="{{ nav_prev_in == nil }}"
    data-nav="prev-in"
  >
    <span class="edge-nav__icon arrow--left" aria-hidden="true"></span>
  </a>

  <!-- RIGHT: next within collection -->
  <a
    class="edge-nav__target edge-nav__right"
    href="{{ nav_next_in | default:'#' }}"
    aria-label="Next in collection"
    aria-disabled="{{ nav_next_in == nil }}"
    data-nav="next-in"
  >
    <span class="edge-nav__icon arrow--right" aria-hidden="true"></span>
  </a>

  <!-- UP: previous collection (first item) -->
  <a
    class="edge-nav__target edge-nav__top"
    href="{{ nav_prev_coll | default:'#' }}"
    aria-label="Previous collection"
    aria-disabled="{{ nav_prev_coll == nil }}"
    data-nav="prev-coll"
  >
    <span class="edge-nav__icon arrow--up" aria-hidden="true"></span>
  </a>

  <!-- DOWN: next collection (first item) -->
  <a
    class="edge-nav__target edge-nav__bottom"
    href="{{ nav_next_coll | default:'#' }}"
    aria-label="Next collection"
    aria-disabled="{{ nav_next_coll == nil }}"
    data-nav="next-coll"
  >
    <span class="edge-nav__icon arrow--down" aria-hidden="true"></span>
  </a>
</div>

<script>
(function () {
  // Early exit if running in an iframe or SSR edge case
  if (typeof window === "undefined" || !document) return;

  function go(href) {
    if (!href || href === "#" || href === "" || href == null) return;
    window.location.assign(href);
  }

  // Resolve targets (skip if disabled)
  const q  = (sel) => document.querySelector(sel);
  const L  = q('[data-nav="prev-in"]');
  const R  = q('[data-nav="next-in"]');
  const U  = q('[data-nav="prev-coll"]');
  const D  = q('[data-nav="next-coll"]');

  const live = (el) => el && el.getAttribute("aria-disabled") !== "true" && el.getAttribute("href") && el.getAttribute("href") !== "#";

  // Keyboard support
  window.addEventListener("keydown", function (e) {
    // Avoid hijacking when user is typing
    const tag = (e.target && e.target.tagName || "").toLowerCase();
    if (tag === "input" || tag === "textarea" || e.metaKey || e.ctrlKey || e.altKey) return;

    switch (e.key) {
      case "ArrowLeft":
        if (live(L)) { e.preventDefault(); go(L.getAttribute("href")); }
        break;
      case "ArrowRight":
        if (live(R)) { e.preventDefault(); go(R.getAttribute("href")); }
        break;
      case "ArrowUp":
        if (live(U)) { e.preventDefault(); go(U.getAttribute("href")); }
        break;
      case "ArrowDown":
        if (live(D)) { e.preventDefault(); go(D.getAttribute("href")); }
        break;
    }
  }, { passive: true });

  // Touch swipe (left/right)
  let touchX = null, touchY = null, t0 = 0;

  function onTouchStart(ev) {
    const t = ev.touches && ev.touches[0];
    if (!t) return;
    touchX = t.clientX; touchY = t.clientY; t0 = Date.now();
  }
  function onTouchEnd(ev) {
    if (touchX === null) return;
    const t = ev.changedTouches && ev.changedTouches[0];
    if (!t) { touchX = touchY = null; return; }
    const dx = t.clientX - touchX;
    const dy = t.clientY - touchY;
    const dt = Date.now() - t0;

    // simple swipe heuristic
    const absX = Math.abs(dx), absY = Math.abs(dy);
    if (dt < 800 && absX > 48 && absX > absY * 1.3) {
      if (dx < 0 && live(R)) go(R.getAttribute("href")); // swipe left -> next
      if (dx > 0 && live(L)) go(L.getAttribute("href")); // swipe right -> prev
    }
    touchX = touchY = null;
  }

  window.addEventListener("touchstart", onTouchStart, { passive: true });
  window.addEventListener("touchend",   onTouchEnd,   { passive: true });

  // If a target has no href, ensure it's visually hidden (safety in case HTML changes)
  [L, R, U, D].forEach(function (el) {
    if (!el) return;
    if (!live(el)) el.setAttribute("aria-disabled", "true");
  });

})();
</script>
